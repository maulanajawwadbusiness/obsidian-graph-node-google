# Forensic Report: HUD Cleanup & Constraint Fight Forensics
**Date:** 2026-01-31
**Focus:** Debug Panel UI Refinement & Deep Physics Instrumentation

## 1. Executive Summary
The primary objective was to transform the Debug Panel from a clutter of legacy diagnostics into a sharp, focused cockpit for **Constraint Fight Forensics**. We achieved this by:
1.  **Plumbing Missing Data:** Connecting internal physics ledgers (Energy, Constraint Conflict) to the React UI.
2.  **Refining Layout:** Implementing a responsive 2-column grid to maximize data density and minimize vertical scrolling.
3.  **Hiding Noise:** Collapsing legacy controls and diagnostics by default.
4.  **Exposing Kill Switches:** Adding advanced isolation toggles for physics subsystems.

## 2. Key Changes & Implementation Details

### A. Data Plumbing (`src/playground/rendering/metrics.ts`)
*   **Problem:** The `energyLedger` and `fightLedger` generated by the physics engine were not reaching the UI components.
*   **Fix:** Updated `createMetricsTracker` to explicitly copy these arrays from `engine.getDebugStats()` into the `renderDebug` object passed to `setMetrics`.
*   **Impact:** The UI now receives real-time forensic data from the physics core.

### B. HUD Layout Refinement (`src/playground/components/CanvasOverlays.tsx`)
*   **2-Column Grid:** Implemented a CSS grid layout:
    *   **Left Column:** Standard Controls, Feel Markers, Advanced Toggles, Physics Summary Stats, Rest Marker Forensic.
    *   **Right Column:** Detailed data tables (Energy Ledger, Constraint Fight Ledger).
*   **Responsiveness:** Added a `ResizeObserver` (via window resize listener) to switch to a single-column layout when width < 450px.
*   **Collapsible Sections:**
    *   **Standard Controls:** Hidden by default.
    *   **Shape Diagnostics / Performance:** Hidden by default (Legacy Diagnostics).
    *   **Rest Marker Forensic:** Added a collapsible toggle (`[▸]`) to hide this dense block when not needed.
*   **Defaults:**
    *   Debug Panel is now **OPEN** by default (`debugOpen = true` in `GraphPhysicsPlayground.tsx`).
    *   Legacy sections are **CLOSED** by default.

### C. Constraint Fight Forensics (Physics Engine)
*   **Instrumentation:** The physics engine now tracks:
    *   **Energy Ledger (v²):** Kinetic energy breakdowns per stage (Input, Spring, Repulsion, Constraint).
    *   **Fight Ledger:** Conflict percentages and average corrections per constraint stage.
*   **Isolation Toggles:** Added "Kill Switches" in the Advanced section to selectively disable:
    *   Diffusion
    *   Micro-Slip
    *   Repulsion
    *   Constraints
    *   Reconcile
    *   V-Mods

## 3. Verification Status
*   **Data Flow:** Verified that ledgers populate with live data when the physics engine runs.
*   **Layout:** Verified 2-column structure fits on standard desktop screens without scrolling. Verified fallback to 1-column on narrow widths.
*   **Interaction:** Ensure pointer events on the HUD do not leak through to the canvas (interactions are captured).
*   **Persistence:** Toggles for legacy sections work as expected.

## 4. Modified Files
*   `src/playground/rendering/metrics.ts`: Data plumbing.
*   `src/playground/components/CanvasOverlays.tsx`: UI layout, state, and rendering logic.
*   `src/playground/GraphPhysicsPlayground.tsx`: Default debug panel state.
*   `src/physics/types.ts`: Added config flags for isolation toggles.

## 5. Next Steps
*   **Drill Down:** Use the new "Start vs. Stop" comparison tools (future work) to analyze specific "slushy" clusters.
*   **Map Title:** Consider moving valid map titles to the top-left if the bottom-center is obstructed.

---
**Signed:** Debug Agent (Antigravity)
**Commit Hashes:**
*   `devtools: hide legacy HUD sections by default`
*   `devtools: make debug HUD two-column (reduce vertical height)`
*   `devtools: set debug panel open by default`
